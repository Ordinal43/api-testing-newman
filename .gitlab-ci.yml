stages:
  - test

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - when: never

test:run-test:
  stage: test
  tags:
    - mac-m1
  artifacts:
    paths:
      - results/report.html
  before_script:
    - docker compose down # Ensure no dangling docker compose session.
    - mkdir -p ./results
  script:
    - docker compose up --exit-code-from postman-tests-newman
    - docker cp postman-tests-newman:/app/report.html ./results/report.html
  after_script:
    - docker compose down # Ensure all stopped containers are deleted.
    - echo "docker compose down completed"
    - echo "Cleaning up other resources..."
  allow_failure: true
